# AEM Developer Agent - Setup Complete

## Overview
Successfully implemented an AEM Developer agent that converts HTML components into fully editable AEM components, one at a time, with user interaction and testing at each step.

## What Was Added

### 1. New Agent: `aem_developer`
**Location:** `src/dev_aem_crew_sys/config/agents.yaml`

- **Role:** Senior AEM Developer and Component Architect
- **Goal:** Convert HTML/CSS components into fully editable AEM components one at a time
- **Key Features:**
  - Works methodically, one component at a time
  - Creates HTL templates, Sling Models, dialogs, and clientlibs
  - Makes everything editable for content authors
  - Follows AEM 6.5 best practices

### 2. New Tasks

**Location:** `src/dev_aem_crew_sys/config/tasks.yaml`

#### a) `aem_component_list_task`
- Scans output/ folder for HTML components
- Lists all available components
- **Asks user to select which component to convert**

#### b) `aem_component_conversion_task`
- Reads selected HTML component
- Creates complete AEM component structure:
  - Component definition (.content.xml)
  - HTL template (.html)
  - Sling Model (Java)
  - Dialog (_cq_dialog.xml)
  - ClientLib (CSS/JS)
- Makes all content editable

#### c) `aem_build_deploy_task`
- Runs Maven build
- Deploys to local AEM instance
- Reports build status

#### d) `aem_testing_task`
- Provides testing instructions to user
- **Asks user if component works correctly**
- If issues found: gathers feedback for fixes
- If working: proceeds to next component

### 3. New Tools

**Location:** `src/dev_aem_crew_sys/tools/`

#### a) `aem_file_writer_tool.py`
- Writes files to AEM project structure
- Creates parent directories automatically
- Supports all file types (HTL, Java, XML, CSS, JS)

#### b) `maven_tool.py`
- Executes Maven commands in AEM project
- Builds and deploys packages
- Reports detailed build status and errors

### 4. Updated Files

#### a) `crew.py`
- Added `aem_developer` agent with AEMFileWriterTool and MavenTool
- Added 4 new AEM tasks
- Imports new tools

#### b) `main.py`
- Added AEM configuration inputs:
  - `output_folder`: './output'
  - `aem_project_path`: Path to hackaempoc project
  - `aem_app_id`: 'hackaempoc'
  - `aem_component_group`: 'Hack AEM POC'
  - `aem_namespace`: 'hack/aem/poc'

## How It Works - User Flow

### Step 1: Agent Lists Components
```
Available HTML Components:
1. navbar.html - Navigation component
2. hero.html - Hero section
3. button.html - Button component
```

### Step 2: Agent Asks User to Select
```
Which component should I convert to AEM?
[ ] navbar
[ ] hero
[ ] button
```

### Step 3: Agent Converts Selected Component
Creates all necessary AEM files:
- `/apps/hackaempoc/components/navbar/.content.xml`
- `/apps/hackaempoc/components/navbar/navbar.html` (HTL)
- `/core/src/main/java/com/hack/aem/poc/core/models/NavbarModel.java`
- `/apps/hackaempoc/components/navbar/_cq_dialog.xml`
- `/apps/hackaempoc/clientlibs/clientlib-navbar/`

### Step 4: Agent Builds & Deploys
```
Running: mvn clean install -PautoInstallPackage
BUILD SUCCESS
Deployed to: http://localhost:4502
```

### Step 5: Agent Asks User to Test
```
Please test the navbar component:
1. Open: http://localhost:4502/editor.html/content/hackaempoc/us/en.html
2. Add navbar component to page
3. Open dialog and edit fields
4. Verify rendering

Did the navbar component work correctly?
[ ] Yes, it works perfectly
[ ] No, there are issues
[ ] Partially works, needs fixes
```

### Step 6: Based on User Feedback
- **If "Yes"**: Mark complete, return to Step 1 for next component
- **If "No"**: Ask for details, fix issues, rebuild, retest
- **If "Partial"**: Gather specific issues, apply fixes

## Project Structure

```
hackaempoc/                           (AEM Project)
â”œâ”€â”€ core/
â”‚   â””â”€â”€ src/main/java/com/hack/aem/poc/core/models/
â”‚       â””â”€â”€ NavbarModel.java          (Generated by agent)
â”œâ”€â”€ ui.apps/
â”‚   â””â”€â”€ src/main/content/jcr_root/apps/hackaempoc/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â””â”€â”€ navbar/               (Generated by agent)
â”‚       â”‚       â”œâ”€â”€ .content.xml
â”‚       â”‚       â”œâ”€â”€ navbar.html
â”‚       â”‚       â””â”€â”€ _cq_dialog.xml
â”‚       â””â”€â”€ clientlibs/
â”‚           â””â”€â”€ clientlib-navbar/     (Generated by agent)
â”‚               â”œâ”€â”€ .content.xml
â”‚               â”œâ”€â”€ css/
â”‚               â”œâ”€â”€ js/
â”‚               â”œâ”€â”€ css.txt
â”‚               â””â”€â”€ js.txt
â””â”€â”€ pom.xml

dev_aem_crew_sys/                     (CrewAI Project)
â”œâ”€â”€ output/                           (HTML components input)
â”‚   â”œâ”€â”€ navbar.html
â”‚   â”œâ”€â”€ hero.html
â”‚   â””â”€â”€ button.html
â””â”€â”€ src/dev_aem_crew_sys/
    â”œâ”€â”€ config/
    â”‚   â”œâ”€â”€ agents.yaml               (Updated)
    â”‚   â””â”€â”€ tasks.yaml                (Updated)
    â”œâ”€â”€ tools/
    â”‚   â”œâ”€â”€ aem_file_writer_tool.py   (New)
    â”‚   â””â”€â”€ maven_tool.py             (New)
    â”œâ”€â”€ crew.py                       (Updated)
    â””â”€â”€ main.py                       (Updated)
```

## AEM Components Created

Each AEM component will include:

### 1. Component Definition (.content.xml)
```xml
<?xml version="1.0" encoding="UTF-8"?>
<jcr:root xmlns:sling="http://sling.apache.org/jcr/sling/1.0"
    xmlns:cq="http://www.day.com/jcr/cq/1.0"
    xmlns:jcr="http://www.jcp.org/jcr/1.0"
    jcr:primaryType="cq:Component"
    jcr:title="Navbar"
    jcr:description="Navigation bar component"
    componentGroup="Hack AEM POC"/>
```

### 2. HTL Template
```html
<sly data-sly-use.model="com.hack.aem.poc.core.models.NavbarModel">
    <nav class="navbar" style="background-color: ${model.backgroundColor}">
        <div class="logo">${model.logoText}</div>
        <ul class="nav-links">
            <li data-sly-list.item="${model.navItems}">
                <a href="${item.url}">${item.label}</a>
            </li>
        </ul>
    </nav>
</sly>
```

### 3. Sling Model (Java)
```java
@Model(adaptables = Resource.class)
public class NavbarModel {
    @ValueMapValue
    private String logoText;

    @ValueMapValue
    private String backgroundColor;

    @ChildResource
    private List<NavItem> navItems;

    // Getters...
}
```

### 4. Dialog (_cq_dialog.xml)
```xml
<content>
    <items>
        <tabs>
            <items>
                <content>
                    <items>
                        <logoText/>
                        <backgroundColor/>
                        <navItems type="nt:unstructured">
                            <field type="multifield">
                                <!-- Nav items configuration -->
                            </field>
                        </navItems>
                    </items>
                </content>
            </items>
        </tabs>
    </items>
</content>
```

### 5. ClientLib
- Organized CSS and JavaScript
- Proper categories for inclusion
- Minification ready

## Next Steps

### To Run the Full Workflow:

1. **Ensure you have HTML components ready:**
   ```bash
   # Place HTML components in output/ folder
   ls output/
   # Should show: navbar.html, hero.html, etc.
   ```

2. **Run the crew:**
   ```bash
   cd C:\Dev\AEM-projects\dev-aem-crew\dev_aem_crew_sys
   crewai run
   ```

3. **Follow the interactive prompts:**
   - Select component to convert
   - Wait for build completion
   - Test in AEM
   - Provide feedback
   - Repeat for next component

### To Customize Configuration:

Edit `main.py` inputs:
```python
inputs = {
    'design_path': './design.png',
    'output_folder': './output',
    'aem_project_path': r'C:\Dev\AEM-projects\dev-aem-crew\hackaempoc',
    'aem_app_id': 'hackaempoc',
    'aem_component_group': 'Hack AEM POC',
    'aem_namespace': 'hack/aem/poc'
}
```

## Key Features

### âœ… Interactive Workflow
- User selects components one at a time
- User confirms testing before proceeding
- User provides feedback for fixes

### âœ… Complete AEM Component
- HTL template with proper syntax
- Sling Model with all properties
- Dialog with all editable fields
- ClientLib properly configured
- Component definition with metadata

### âœ… Author-Friendly
- Everything editable via dialog
- Text, images, links, colors, spacing
- Multifield for repeating elements
- Clear field descriptions

### âœ… Build & Deploy
- Automatic Maven build
- Deploy to local AEM
- Error reporting
- Success verification

### âœ… Testing & Feedback
- Clear testing instructions
- User confirmation required
- Issue tracking and fixing
- Iterative improvement

## Troubleshooting

### If Build Fails:
- Check Java compilation errors in output
- Verify Sling Model imports and annotations
- Check AEM is running on port 4502

### If Component Doesn't Appear:
- Check Package Manager for installed packages
- Verify component group matches allowed components
- Check CRXDE for component files

### If Dialog Doesn't Work:
- Verify _cq_dialog.xml syntax
- Check field names match Sling Model properties
- Restart AEM if needed

## Success Criteria

For each component, the agent ensures:
1. âœ… All files created successfully
2. âœ… Maven build passes
3. âœ… Package deploys to AEM
4. âœ… Component appears in component browser
5. âœ… Dialog opens and all fields are editable
6. âœ… Component renders correctly on page
7. âœ… User confirms component works

Only then does it proceed to the next component!

---

**Status:** Ready for testing! ðŸš€
**Next Action:** Place HTML components in output/ folder and run `crewai run`
